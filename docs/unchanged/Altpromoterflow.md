### `docs/Hichipsnake.md`

# Hichipsnake: HiChIP/PLAC-Seq Pipeline

`Hichipsnake` processes paired-end HiChIP or PLAC-seq FASTQ gz files into interaction maps and significant contacts using Hicdcplus, Hichipper, Fithichip and Maps.


## Usage
```bash
Hichipsnake [options]
```

### Required Arguments
- `-i/--input_dir`: Directory containing FASTQ gz files.
- `-o/--output_dir`: Output directory.
- `--organism`: Genome assembly, the same as Genomesetup step (e.g., `hg38`).
- `--genome_dir`: Directory from Genomesetup step (e.g., `/abs/path/to/genome`).

### Optional Arguments
- `--pipeline`: Analysis software to use. Options: Maps, Fithichip, Hichipper, Hicdcplus, All. Default: All.
- `--downsample_size`: Number of valid pairs to downsample to (e.g., 50000000). Set to 0 to disable (default: 0).
- `--restriction_enzyme`: Restriction enzyme used in the experiment. Options: mboi (default), hindiii, dpnii, bglii, ncoi, msei, hinfI, mnase, arima.
- `--bin_size`: Interaction bin size in base pairs (e.g., 10000). Default: 5000.
- `--binning_range`: Maximum distance for binning interactions in base pairs (e.g., 1000000). Default: 2000000.
- `--length_cutoff`: Minimum fragment length for long contacts in base pairs (e.g., 1000). Default: 1000.
- `--threads`: Number of CPU threads for parallel processing (e.g., 100). Default: 30.
- `--fdr`: Minimum FDR threshold for significant interactions (e.g., 0.05). Default: 0.01.
- `--macs2_peaks`: Optional path to a MACS2 peaks file (e.g., peaks.narrowPeak) from ChIP-seq data to refine interactions. Default: NA (none).
- `--fithichip_BiasType`: FitHiChIP bias correction type. Options: 1 (coverage-based, default), 2 (ICE-based).
- `--maps_count_cutoff`: Minimum read count for MAPS significant interactions (e.g., 5). Default: 5.
- `--maps_ratio_cutoff`: Minimum observed-to-expected ratio for MAPS (e.g., 2.0). Default: 2.0.
- `--maps_model`: Statistical model for MAPS regression. Options: pospoisson (default), negbinom.
- `--maps_sex_chroms`: Sex chromosomes to include in MAPS analysis. Options: NA (none), X (default), Y, XY.
- `--hicpro_params`: Optional HiC-Pro config file path. Default: NA (none).
- `--hichipper_params`: Optional space-separated Hichipper parameters (e.g., --read-length 75). Default: NA (none).
- `--hicdc_params`: Optional space-separated Hicdcplus parameters (e.g., --PeakFile peaks.bed). Default: NA (none).
- `--samples_comparison`: Space-separated sample names for differential analysis (e.g., SampleA SampleB). Default: none.


### Example
```bash
Hichipsnake.py \
  -i /path/to/your/fastqs/ \
  -o /path/to/your/output/ \
  --genome_dir /path/to/your/genome/ \
  --organism hg38 \
  --pipeline All \
  --threads 30 \
  --bin_size 5000 \
  --downsample_size 50000000 \
  --fdr 0.01 \
  --maps_model negbinom \
  --maps_sex_chroms X
```

## Hichipsnake Output
```
hichip_test_samples_output$ tree -L 1
.
├── benchmarks
├── fastqc
├── fithichip
├── hicdcplus
├── hichipper
├── hichipsnake_run_1.log
├── hicpro
├── logs
├── maps
├── maps_feather
├── originalFastqs
├── peaks
├── processedFastqs
├── qc
├── significant_interactions
└── differential_interactions_sampleA_vs_sampleB
```

hichip_test_samples_output/
- **`benchmarks`** - Benchmarking data for pipeline steps, including runtime and memory usage per sample (e.g., `benchmarks/hicpro_run.{sample}.txt`).
- **`fastqc`** - FastQC quality control reports for raw or processed FASTQ files (e.g., `fastqc/{sample}_R1_fastqc.html`).
- **`fithichip`** - FitHiChIP analysis outputs, including significant peak-to-all interactions (e.g., `fithichip/{sample}/FitHiChIP_peaktoall_BinSize{bin_size}/FitHiChIP.interactions.peaktoall.significant.bed`).
- **`hicdcplus`** - Hicdcplus analysis outputs, containing significant interaction BEDPE files (e.g., `hicdcplus/{sample}/significant_interactions.bedpe.gz`).
- **`hichipper`** - Hichipper analysis outputs, including filtered intrachromosomal loop counts (e.g., `hichipper/{sample}/one.filt.intra.loop_counts.bedpe`).
- **`hichipsnake_run_1.log`** - Top-level log file for the entire pipeline run, capturing execution details and errors.
- **`hicpro`** - HiC-Pro processing outputs, including BAM files, valid pairs, and interaction matrices (e.g., `hicpro/{sample}/hic_results/data/{sample}/{sample}.allValidPairs`).
- **`logs`** - Detailed log files for individual pipeline steps per sample (e.g., `logs/hichip_qc.{sample}.log`).
- **`maps`** - MAPS analysis outputs, containing significant 3D interaction BEDPE files (e.g., `maps/{sample}/{sample}.{bin_size/1000}k.sig3Dinteractions.bedpe`).
- **`maps_feather`** - Intermediate Feather-format files from MAPS preprocessing, including QC stats (e.g., `maps_feather/{sample}/{sample}.feather.qc.tsv`).
- **`originalFastqs`** - Original input FASTQ files copied from `--input_dir` (e.g., `originalFastqs/{sample}/{sample}_R1.fastq.gz`).
- **`peaks`** - Peak files, either user-provided or generated by MACS2 (e.g., `peaks/{sample}_peaks.narrowPeak`).
- **`processedFastqs`** - Processed FASTQ files after initial QC or filtering (e.g., `processedFastqs/{sample}/{sample}_R1.fastq.gz`).
- **`qc`** - All the quality control results, including custom HiChIP QC tables (e.g., `qc/{sample}_hichip_qc.tsv`). This is one of the final result folders generated by the pipeline.
- **`significant_interactions`** - All the bedpe files containing significant interactions from each software. This is one of the final result folders generated by the pipeline.
- **`differential_interactions_sampleA_vs_sampleB`** - All the bedpe files containing differential significant interactions between sampleA and sampleB. This is one of the final result folders generated by the pipeline.

## Notes
- FASTQ Naming: Files should be named {sample}_R1.fastq.gz and {sample}_R2.fastq.gz.
- Downsampling: Use --downsample_size for uniform sample comparison.
- Pipeline Selection: Choose All to run all tools, or specify a single tool (e.g., Maps) for targeted analysis.
- Custom Parameters: Use --hicpro_params, --hichipper_params, or --hicdc_params to pass tool-specific options.
- Differential Analysis: Provide --samples_comparison for pairwise sample comparisons (if implemented).

